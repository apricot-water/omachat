<!DOCTYPE html>
<html lang="de">
<head>
<script src="../../isolation.js"></script>  
    <meta charset="UTF-8">
    <title>Pro Diff Checker | Lokal & Sicher</title>
    
    <!-- CSS fÃ¼r das Design und Diff-Farben -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css">
    
    <style>
        :root {
            --bg: #f6f8fa;
            --panel: #ffffff;
            --text: #24292f;
            --border: #d0d7de;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            --bg: #0d1117;
            --panel: #161b22;
            --text: #c9d1d9;
            --border: #30363d;
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; transition: all 0.3s; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        .input-container { display: flex; gap: 20px; margin-bottom: 20px; height: 300px; }
        .input-box { flex: 1; display: flex; flex-direction: column; background: var(--panel); padding: 10px; border: 1px solid var(--border); border-radius: 8px; }
        
        .file-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        label { font-weight: bold; font-size: 14px; }
        .file-input { font-size: 12px; max-width: 200px; }

        textarea { flex: 1; padding: 10px; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace; border: 1px solid var(--border); border-radius: 4px; background: var(--bg); color: var(--text); resize: none; }
        
        .controls { text-align: center; margin-bottom: 20px; }
        button { padding: 12px 40px; background-color: #2ea44f; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button:hover { background-color: #2c974b; }
        
        .theme-btn { padding: 5px 10px; background: var(--border); border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }

        .summary { display: flex; justify-content: center; gap: 20px; margin-bottom: 15px; font-weight: bold; display: none; }
        .added { color: #1a7f37; }
        .removed { color: #cf222e; }

        #diff-output { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        
        /* Korrektur fÃ¼r Dark Mode Diff Sichtbarkeit */
        body.dark-mode .d2h-file-wrapper { background-color: #0d1117; border-color: #30363d; }
        body.dark-mode .d2h-code-line-ctn { color: #c9d1d9; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Lokaler Side-by-Side Vergleich</h2>
        <button class="theme-btn" onclick="toggleTheme()">ðŸŒ“ Dark Mode umschalten</button>
    </div>

    <div class="input-container">
        <!-- LINKES PANEL -->
        <div class="input-box">
            <div class="file-controls">
                <label>ALT (Original)</label>
                <input type="file" class="file-input" onchange="loadFile(this, 'left-text')">
            </div>
            <textarea id="left-text" placeholder="Text hier einfÃ¼gen oder Datei links oben wÃ¤hlen...">Beispiel:
Zeile 1
Zeile 2
Zeile 3</textarea>
        </div>

        <!-- RECHTES PANEL -->
        <div class="input-box">
            <div class="file-controls">
                <label>NEU (GeÃ¤ndert)</label>
                <input type="file" class="file-input" onchange="loadFile(this, 'right-text')">
            </div>
            <textarea id="right-text" placeholder="Text hier einfÃ¼gen oder Datei links oben wÃ¤hlen...">Beispiel:
Zeile 1
Zeile 2 geÃ¤ndert
Zeile 3
Zusatzzeile</textarea>
        </div>
    </div>

    <div class="controls">
        <button id="compare-btn">Texte vergleichen</button>
    </div>

    <div id="summary" class="summary">
        <span id="stat-added" class="added"></span>
        <span id="stat-removed" class="removed"></span>
    </div>

    <div id="diff-output"></div>

    <!-- Scripte -->
    <script src="https://cdn.jsdelivr.net/npm/diff/dist/diff.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html.min.js"></script>

    <script>
        // Datei-Upload Logik
        function loadFile(input, targetId) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById(targetId).value = e.target.result;
                drawDiff(); // Automatischer Vergleich nach Upload
            };
            reader.readAsText(file);
        }

        // Dark Mode Toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        // Hauptfunktion zum Vergleichen
        function drawDiff() {
            const oldText = document.getElementById('left-text').value;
            const newText = document.getElementById('right-text').value;
            const outputDiv = document.getElementById('diff-output');
            const summaryDiv = document.getElementById('summary');

            try {
                // 1. Patch erzeugen
                const patch = Diff.createPatch("Ã„nderungen", oldText, newText);

                // 2. Statistiken berechnen (Zeilen zÃ¤hlen)
                const diffLines = Diff.diffLines(oldText, newText);
                let added = 0;
                let removed = 0;
                diffLines.forEach(part => {
                    if (part.added) added += part.count;
                    if (part.removed) removed += part.count;
                });

                document.getElementById('stat-added').innerText = "+" + added + " Zeilen";
                document.getElementById('stat-removed').innerText = "-" + removed + " Zeilen";
                summaryDiv.style.display = 'flex';

                // 3. HTML generieren
                const diffHtml = Diff2Html.html(patch, {
                    drawFileList: false,
                    matching: 'lines',
                    outputFormat: 'side-by-side',
                    synchronisedScroll: true
                });

                outputDiv.innerHTML = diffHtml;
                
            } catch (err) {
                console.error(err);
                alert("Fehler beim Vergleich: " + err.message);
            }
        }

        document.getElementById('compare-btn').addEventListener('click', drawDiff);
    </script>
</body>
</html>
